@model  List<BusinessObject.SupplierTransBO>

@{
    Layout = null;
}

<link href="~/Content/Kendo/kendo.common.min.css" rel="stylesheet" />
<link href="~/Content/Kendo/kendo.default.min.css" rel="stylesheet" />
<link href="~/Content/Kendo/kendo.default.mobile.min.css" rel="stylesheet" />

<script src="~/Scripts/jquery-3.6.0.js"></script>
<script src="~/Scripts/jquery-3.6.0.min.js"></script>
<script src="~/Scripts/Kendo/kendo.all.min.js"></script>
<script src="~/Scripts/Kendo/kendo.aspnetmvc.min.js"></script>

<body>

    <div id="compWindowLayout" style="display: flex; flex-direction: column;">
        <div id="upperDiv" style="height: 50%;">
            <div id="selectionFields" style="display: flex; flex-direction: row;">
              
                 

                <div id="MiddlePanel" style="width:50%;">

                    @(Html.Kendo().DropDownList().Name("ddlAbbrevatiion")
                     .OptionLabel("Select Abbrevatiion ...")
                     .DataTextField("ABB")
                     .DataValueField("ABB")
                     .HtmlAttributes(new { style = "margin-left: 25px; margin-top: 5px; margin-bottom: 5px; width: 260px;", id = "ddlAbbrevatiion" })
                    )

                    @(Html.Kendo().DropDownList().Name("ddlSupplier")
                     .OptionLabel("Select Supplier ...")
                     .DataTextField("VendorName")
                     .DataValueField("VendorID")
                     .HtmlAttributes(new { style = "margin-left: 25px; margin-top: 5px; margin-bottom: 5px; width: 260px;", id = "ddlSupplier" })
                    )
                    

                </div>
                
            </div>
        </div>
        <div id="lowerDiv" style="height: 50%;">
            <div id="SupplierTransGrid"></div>
        </div>
        <div id="actionButtonDiv">
            <button class="k-button k-primary" type="button" id="cmdSave" style="width: 130px; margin-right: 5px;" onclick="saveRecords()">Save</button>
        </div>
    </div>

    <script type="text/javascript">
        $.ajax({
            url: "@Url.Action("PopulateDDLTables", "SupplierTrans")",
            type: "post",
        success: function (data) {
            ddlAbbrivation = data.ABB;
            if (ddlAbbrivation.length > 0) {
                var Abbrivationddl = $("#ddlAbbrivation").data("kendoDropDownList");
                Abbrivationddl.setDataSource(ddlAbbrivation);
            }

            ddlManufacturers = data.Manufacturers;
            if (ddlManufacturers.length > 0) {
                var ManDDL = $("#ddlManufacturer").data("kendoDropDownList");
                ManDDL.setDataSource(ddlManufacturers);
            }

            
        },
        async: false
        });
   
        var SupplierTransgridDS = @Html.Raw(Json.Encode(Model));

        var dataSource = new kendo.data.DataSource({
            schema: {
                model: {
                    id: "PartID",
                    fields: {
                        PartSuppierID: { type: "number", editable: false},
                        VendorID: { type: "number", editable: false},
                        VendorPartNo: { type: "string", editable: false},
                        VendorPartDescription: { type: "string", editable: false},
                        Vendorprice: { type: "number" },
                        Ourprice: { type: "number" },
                        Priority: { type: "number" },
                        Note: { type: "string" },
                        SupplierName: { type: "string", editable: false},
                        SOURCE: { type: "string", editable: false }

                    }
                }
            },
            transport: {
                read: function (options) { options.success(SupplierTransgridDS); },
                update: function(options) { options.success(); },
                create: function(options) {
                    SupplierTransgridDS.push(options.data);
                    options.success(options.data);
                },
                destroy: function(options) {
                    SupplierTransgridDS.splice(options.data.RowID - 1, 1);
                    options.success(options.data);
                }
            },
            requestEnd: function (e) {
                if (e.type == "create" || e.type == "update" || e.type == "delete") {
                    this.read();
                }
                else if (e.type == "read") {
                }
            },
            error: function (obj) {
                alert("Status: " + obj.status + "; Error Message: " + obj.errorThrown);
            }
        });

        $("#SupplierTransGrid").kendoGrid({
            dataSource: dataSource,


            columns: [
                {
                    field: "VendorID",
                    name: "VendorID",
                    hidden:true
                },
                {
                    field: "PartSuppierID",
                    name: "PartSuppierID",
                    hidden: true
                },
                {
                    field: "SupplierName",
                    title: "Supplier Name",
                    name: "Supplier Name",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },

                },
                {
                    field: "VendorPartNo",
                    title: "VendorPartNo",
                    name: "VendorPartNo",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },

                },
                {
                    field: "VendorPartDescription",
                    title: "VendorPartDescription",
                    name: "VendorPartDescription",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },

                },
                {
                    field: "Vendorprice",
                    title: "Vendorprice",
                    name: "Vendorprice",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },
                    editor: function (container) {
                        var input = $('<input id="Vendorprice" name="Vendorprice" class="k-input numbers">');
                        input.appendTo(container);
                        input.kendoNumericTextBox({
                            format: "{0:n0}",
                            decimals: 0,
                            min: 0,
                            max: 100,
                            spinners: false
                        });

                    },
                    width: 50
                },
                {
                    field: "Ourprice",
                    title: "Ourprice",
                    name: "Ourprice",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },
                    editor: function (container) {
                        var input = $('<input id="Ourprice" name="Ourprice" class="k-input numbers">');
                        input.appendTo(container);
                        input.kendoNumericTextBox({
                            format: "{0:n0}",
                            decimals: 0,
                            min: 0,
                            max: 100,
                            spinners: false
                        });

                    },
                    width: 50
                },
                {
                    field: "Priority",
                    title: "Priority",
                    name: "Priority",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },
                    editor: function (container) {
                        var input = $('<input id="Priority" name="Priority" class="k-input numbers">');
                        input.appendTo(container);
                        input.kendoNumericTextBox({

                            decimals: 0,
                            min: 0,
                            max: 100,
                            spinners: false
                        });

                    },
                    width: 50
                },
                {
                    field: "Note",
                    title: "Note",
                    name: "Note",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },
                    editor: function (container) {
                        var input = $('<input id="Note" name="Note" class="k-input numbers">');
                        input.appendTo(container);
                        input.kendoTextBox({

                        });

                    },
                    width: 50
                },
                {
                    field: "SOURCE",
                    title: "SOURCE",
                    name: "SOURCE",
                    headerAttributes: { "class": "table-header-cell", style: "font-size: 12px;" },
                    attributes: { style: "font-size: 12px;" },

                },
            ],
            editable: true,
            height: 400,
            groupable: false,
            sortable: true,
            pageable: false,
            scrollable: true
        });

    function saveRecords() {

        var compGrid = $("#SupplierTransGrid").data("kendoGrid");
        var compGridData = compGrid.dataSource.view()
        if (compGridData.length > 0) {
            for(var i = 0; i < compGridData.length; i++) {
                if (compGridData[i].PartLinkID == 0) {
                    compRecords.push(compGridData[i]);
                }
            }
        }

        parent.$("#SupplierTransGrid").data("kendoWindow").close();
    }
    </script>

</body>